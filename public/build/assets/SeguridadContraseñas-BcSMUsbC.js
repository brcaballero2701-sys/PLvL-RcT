import{j as e}from"./app-DJ5bgocT.js";import{b as v,r as o,a as S,H as q,L as b}from"./vendor-x9zrslyQ.js";import{u as C}from"./useSystemColors-YCC1fkpO.js";import{A as k}from"./arrow-left-CnFJRCdA.js";import{S as N}from"./shield-sybB8x6n.js";import{C as E}from"./circle-check-big-BY_4AP0I.js";import{T as w}from"./triangle-alert-BIyt8psk.js";import{c as M}from"./createLucideIcon-DJ0S87ah.js";import{S as R}from"./save-CdFK5_sq.js";import{R as z}from"./rotate-ccw-D3c9r7hf.js";import{S as A}from"./settings-BHex1vnf.js";const L=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],T=M("loader",L),D=()=>{const{props:t}=v(),s=t.systemSettings||t.auth?.systemSettings||{},[g,m]=o.useState(null),[y,_]=o.useState(!1),u=o.useCallback(async(c,i,f)=>{try{_(!0),m(null);const x=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");if(!x)throw new Error("Token CSRF no encontrado");const r=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":x,"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},body:JSON.stringify(i)});if(!r.ok){const n=await r.json().catch(()=>({message:"Error desconocido"}));throw new Error(n.message||`Error ${r.status}`)}const l=await r.json();if(l.success)return m(null),{success:!0,data:l.data,message:l.message};{const n=l.message||"Error al guardar configuraci√≥n";throw m(n),new Error(n)}}catch(x){const r=x.message||"Error de conexi√≥n";return m(r),console.error(`Error en updateSetting (${c}):`,x),{success:!1,error:r,message:r}}finally{_(!1)}},[]),d=o.useCallback(async(c,i,f)=>u(c,i,f),[u]),p=o.useCallback((c,i=null)=>s[c]!==void 0?s[c]:i,[s]),a=o.useCallback(c=>{const i=`${c}_enabled`;return s[i]!==!1},[s]),h=o.useCallback(()=>{m(null)},[]);return{systemSettings:s,logoPath:s?.logo_path||"/images/sena-logo.png",systemName:s?.system_name||"Sistema SENA",primaryColor:s?.primary_color||"green",colorScheme:s?.color_scheme||"green-600",locale:s?.locale||s?.language||"es",theme:s?.theme||"light",securitySettings:{password_min_length:s?.password_min_length||8,password_require_uppercase:s?.password_require_uppercase!==!1,password_require_numbers:s?.password_require_numbers!==!1,password_require_special:s?.password_require_special||!1,password_expiration_days:s?.password_expiration_days||90,max_login_attempts:s?.max_login_attempts||5},notificationSettings:{color_success:s?.notification_color_success||"green",color_error:s?.notification_color_error||"red",color_warning:s?.notification_color_warning||"yellow",color_info:s?.notification_color_info||"blue",duration:s?.notification_duration||5,position:s?.notification_position||"top-right",sound:s?.notification_sound||!1,animation:s?.notification_animation||"slide"},schedules:{manana_inicio:s?.manana_inicio||"06:00",manana_fin:s?.manana_fin||"11:45",tarde_inicio:s?.tarde_inicio||"12:00",tarde_fin:s?.tarde_fin||"17:45",noche_inicio:s?.noche_inicio||"18:00",noche_fin:s?.noche_fin||"21:45"},isSyncing:y,syncError:g,updateSetting:u,updateSection:d,getSetting:p,isSectionEnabled:a,clearSyncError:h,hasCustomLogo:()=>!!(s?.logo_path&&s.logo_path!=="/images/sena-logo.png"),refresh:()=>S.visit(route("admin.configuraciones"),{preserveState:!0,preserveScroll:!0})}};function J(){C();const{systemSettings:t,updateSetting:s,isSyncing:g,syncError:m,clearSyncError:y}=D(),[_,u]=o.useState(""),[d,p]=o.useState({}),[a,h]=o.useState({password_min_length:t?.password_min_length||8,password_require_uppercase:t?.password_require_uppercase!==!1,password_require_numbers:t?.password_require_numbers!==!1,password_require_special:t?.password_require_special||!1,password_expiration_days:t?.password_expiration_days||90});o.useEffect(()=>{h({password_min_length:t?.password_min_length||8,password_require_uppercase:t?.password_require_uppercase!==!1,password_require_numbers:t?.password_require_numbers!==!1,password_require_special:t?.password_require_special||!1,password_expiration_days:t?.password_expiration_days||90})},[t]);const c=()=>{const r={};return a.password_min_length<6&&(r.password_min_length="M√≠nimo 6 caracteres requeridos"),a.password_min_length>20&&(r.password_min_length="M√°ximo 20 caracteres permitidos"),a.password_require_special&&a.password_min_length<10&&(r.password_min_length="La longitud m√≠nima debe ser al menos 10 caracteres si se requieren caracteres especiales"),a.password_expiration_days<0&&(r.password_expiration_days="No puede ser negativo"),a.password_expiration_days>365&&(r.password_expiration_days="M√°ximo 365 d√≠as permitidos"),r},i=(r,l)=>{h(n=>({...n,[r]:l})),d[r]&&p(n=>{const j={...n};return delete j[r],j}),y()},f=async r=>{r.preventDefault();const l=c();if(Object.keys(l).length>0){p(l);return}const n=await s("security",a,route("configuraciones.seguridad"));n.success?(u("‚úÖ Pol√≠ticas de seguridad guardadas exitosamente"),p({}),setTimeout(()=>u(""),3e3)):n.errors&&p(n.errors)},x=async()=>{if(!confirm("¬øEst√°s seguro de restablecer todas las configuraciones de seguridad a los valores por defecto?"))return;const r={password_min_length:8,password_require_uppercase:!0,password_require_numbers:!0,password_require_special:!1,password_expiration_days:90};h(r),(await s("security",r,route("configuraciones.seguridad"))).success&&(u("‚úÖ Configuraciones restablecidas a valores por defecto"),p({}),setTimeout(()=>u(""),3e3))};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(q,{title:"Seguridad y Contrase√±as - SENA"}),e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{href:route("admin.configuraciones"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(k,{size:20})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"mr-3 text-green-600",size:24}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Seguridad y Contrase√±as"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configura las pol√≠ticas de seguridad del sistema"})]})]})]}),e.jsx(b,{href:route("admin.configuraciones"),className:"px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors",children:"Volver"})]})})}),_&&e.jsx("div",{className:"bg-green-50 border-b border-green-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"text-green-600 mr-3",size:20}),e.jsx("p",{className:"text-green-700 font-medium",children:_})]})})}),m&&e.jsx("div",{className:"bg-red-50 border-b border-red-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(w,{className:"text-red-600 mr-3 mt-0.5",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-700 font-medium",children:"Error al guardar"}),e.jsx("p",{className:"text-red-600 text-sm mt-1",children:m})]}),e.jsx("button",{onClick:y,className:"text-red-600 hover:text-red-800 font-bold ml-4",children:"‚úï"})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("form",{onSubmit:f,className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-6 flex items-center",children:[e.jsx(N,{className:"mr-2 text-blue-600",size:20}),"Pol√≠ticas de Contrase√±a"]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Longitud M√≠nima de Contrase√±a"}),e.jsx("input",{type:"number",min:"6",max:"20",value:a.password_min_length,onChange:r=>i("password_min_length",parseInt(r.target.value)),className:`w-24 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${d.password_min_length?"border-red-500 bg-red-50":"border-gray-300"}`}),d.password_min_length&&e.jsxs("p",{className:"text-red-600 text-sm mt-1 flex items-center",children:[e.jsx(w,{size:14,className:"mr-1"}),d.password_min_length]})]}),e.jsxs("div",{className:"text-sm text-gray-500 ml-4",children:["Actual: ",a.password_min_length," caracteres"]})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-base font-medium text-gray-900 mb-4",children:"Requisitos Especiales"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors",children:[e.jsx("input",{type:"checkbox",checked:a.password_require_uppercase,onChange:r=>i("password_require_uppercase",r.target.checked),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"Requerir may√∫sculas y min√∫sculas (Ej: AaBbCc)"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors",children:[e.jsx("input",{type:"checkbox",checked:a.password_require_numbers,onChange:r=>i("password_require_numbers",r.target.checked),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"Requerir n√∫meros (Ej: 123)"})]}),e.jsxs("label",{className:"flex items-center cursor-pointer hover:bg-gray-50 p-3 rounded-lg transition-colors",children:[e.jsx("input",{type:"checkbox",checked:a.password_require_special,onChange:r=>i("password_require_special",r.target.checked),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("span",{className:"ml-3 text-sm font-medium text-gray-700",children:"Requerir caracteres especiales (Ej: !@#$%^&*)"})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"Requisitos actuales:"}),e.jsxs("ul",{className:"text-xs text-blue-800 space-y-1",children:[e.jsxs("li",{children:["‚úì M√≠nimo ",a.password_min_length," caracteres"]}),a.password_require_uppercase&&e.jsx("li",{children:"‚úì May√∫sculas y min√∫sculas"}),a.password_require_numbers&&e.jsx("li",{children:"‚úì N√∫meros"}),a.password_require_special&&e.jsx("li",{children:"‚úì Caracteres especiales"})]})]})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expiraci√≥n de Contrase√±a"}),e.jsx("input",{type:"number",min:"0",max:"365",value:a.password_expiration_days,onChange:r=>i("password_expiration_days",parseInt(r.target.value)),className:`w-24 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent ${d.password_expiration_days?"border-red-500 bg-red-50":"border-gray-300"}`}),d.password_expiration_days&&e.jsxs("p",{className:"text-red-600 text-sm mt-1 flex items-center",children:[e.jsx(w,{size:14,className:"mr-1"}),d.password_expiration_days]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"D√≠as hasta que la contrase√±a expire (0 = sin expiraci√≥n)"})]}),e.jsx("div",{className:"text-sm text-gray-500 ml-4",children:a.password_expiration_days===0?"Sin expiraci√≥n":`${a.password_expiration_days} d√≠as`})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"submit",disabled:g,className:"flex items-center px-6 py-3 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"animate-spin mr-2",size:16}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{size:16,className:"mr-2"}),"Guardar Cambios"]})}),e.jsx(b,{href:route("admin.configuraciones"),className:"flex items-center px-6 py-3 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Cancelar"})]}),e.jsxs("button",{type:"button",onClick:x,disabled:g,className:"flex items-center px-4 py-2 text-red-600 hover:bg-red-50 rounded-md transition-colors disabled:opacity-50",children:[e.jsx(z,{size:16,className:"mr-2"}),"Restablecer Defectos"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsxs("h4",{className:"text-lg font-semibold text-blue-900 mb-3 flex items-center",children:[e.jsx(A,{className:"mr-2",size:20}),"üí° Recomendaciones de Seguridad"]}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsx("li",{children:"‚úì Longitud m√≠nima recomendada: 8-12 caracteres"}),e.jsx("li",{children:"‚úì Activar may√∫sculas y min√∫sculas para mayor seguridad"}),e.jsx("li",{children:"‚úì Incluir n√∫meros es fundamental para prevenir ataques"}),e.jsx("li",{children:"‚úì Caracteres especiales: solo si el nivel de seguridad lo requiere"}),e.jsx("li",{children:"‚úì Expiraci√≥n: 90 d√≠as es un est√°ndar seguro"})]})]})]})})]})}export{J as default};
