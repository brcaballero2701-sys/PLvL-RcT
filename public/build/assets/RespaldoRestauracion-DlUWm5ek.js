import{j as e}from"./app-DJ5bgocT.js";import{r as l,H as G,L as T}from"./vendor-x9zrslyQ.js";import{u as I}from"./useSystemColors-YCC1fkpO.js";import{A as M}from"./arrow-left-CnFJRCdA.js";import{c as _}from"./createLucideIcon-DJ0S87ah.js";import{D as f}from"./download-BHf5bgVU.js";import{U as D}from"./upload-B6YtIVIu.js";import{T as z}from"./triangle-alert-BIyt8psk.js";import{C as P}from"./calendar-lDWT8Q70.js";import{T as K}from"./trash-2-6pqDQCm4.js";const $=[["path",{d:"M13.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v11.5",key:"4pqfef"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 12v-1",key:"1ej8lb"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M8 7V6",key:"1nbb54"}],["circle",{cx:"8",cy:"20",r:"2",key:"ckkr5m"}]],H=_("file-archive",$);function ne(){const{colors:m}=I(),[x,b]=l.useState([]),[V,X]=l.useState(null),[J,Q]=l.useState(null),[y,g]=l.useState(!1),[n,j]=l.useState(null),[N,v]=l.useState(!1),[A,u]=l.useState(!1),[p,w]=l.useState(null),[i,h]=l.useState(""),[k,R]=l.useState(!1),[d,r]=l.useState({type:"",text:""});l.useEffect(()=>{E()},[]);const E=async()=>{try{const t=await(await fetch(route("backup.list"))).json();t.success&&b(t.backups||[])}catch(s){console.error("Error al cargar respaldos:",s)}},q=async()=>{if(confirm("¬øDeseas crear un respaldo de la base de datos ahora?")){g(!0),r({type:"",text:""});try{const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),a=await(await fetch(route("backup.generate"),{method:"POST",headers:{"X-CSRF-TOKEN":s,Accept:"application/json"}})).json();a.success?(r({type:"success",text:"‚úÖ Respaldo creado exitosamente"}),await E(),setTimeout(()=>r({type:"",text:""}),3e3)):r({type:"error",text:"‚ùå "+(a.message||"Error al crear respaldo")})}catch(s){r({type:"error",text:"‚ùå Error: "+s.message})}finally{g(!1)}}},F=s=>{const t=s.target.files[0];if(t){if(!t.name.endsWith(".sql")){r({type:"error",text:"‚ùå Por favor selecciona un archivo .sql v√°lido"});return}if(t.size>100*1024*1024){r({type:"error",text:"‚ùå El archivo es demasiado grande. Tama√±o m√°ximo: 100MB"});return}j(t),r({type:"",text:""})}},L=async()=>{if(!n){r({type:"error",text:"‚ùå Por favor selecciona un archivo primero"});return}v(!0);const s=new FormData;s.append("backup_file",n);try{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),o=await(await fetch(route("backup.upload"),{method:"POST",headers:{"X-CSRF-TOKEN":t},body:s})).json();o.success?(w({filename:o.filename,backup_name:n.name}),u(!0),r({type:"success",text:"‚úÖ Archivo subido. Confirma la restauraci√≥n."})):r({type:"error",text:"‚ùå "+(o.message||"Error al subir archivo")})}catch(t){r({type:"error",text:"‚ùå Error: "+t.message})}finally{v(!1)}},S=async()=>{if(!i){r({type:"error",text:"‚ùå Debes ingresar tu contrase√±a para restaurar"});return}R(!0);try{const s=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),a=await(await fetch(route("backup.restore"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s},body:JSON.stringify({filename:p.filename,password:i})})).json();a.success?(r({type:"success",text:"‚úÖ Base de datos restaurada exitosamente. Recargando..."}),u(!1),w(null),h(""),j(null),setTimeout(()=>{window.location.reload()},2e3)):r({type:"error",text:"‚ùå "+(a.message||"Error al restaurar")})}catch(s){r({type:"error",text:"‚ùå Error: "+s.message})}finally{R(!1)}},O=async s=>{try{r({type:"",text:"Descargando..."});const t=await fetch(route("backup.download",{filename:s}),{method:"GET"});if(!t.ok)throw new Error("Error al descargar el respaldo");const a=await t.blob(),o=window.URL.createObjectURL(a),c=document.createElement("a");c.href=o,c.download=s,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(o),r({type:"success",text:"‚úÖ Respaldo descargado correctamente"}),setTimeout(()=>r({type:"",text:""}),2e3)}catch(t){r({type:"error",text:"‚ùå Error: "+t.message})}},U=async s=>{if(confirm("¬øEst√°s seguro de que deseas eliminar este respaldo? Esta acci√≥n no se puede deshacer."))try{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),o=await(await fetch(route("backup.delete",{filename:s}),{method:"DELETE",headers:{"X-CSRF-TOKEN":t,Accept:"application/json"}})).json();o.success?(r({type:"success",text:"‚úÖ Respaldo eliminado correctamente"}),b(x.filter(c=>c.filename!==s)),setTimeout(()=>r({type:"",text:""}),2e3)):r({type:"error",text:"‚ùå "+(o.message||"Error al eliminar")})}catch(t){r({type:"error",text:"‚ùå Error: "+t.message})}},B=s=>typeof s=="number"?new Date(s*1e3).toLocaleString("es-ES"):new Date(s).toLocaleString("es-ES"),C=s=>{const t=["B","KB","MB","GB"];let a=s,o=0;for(;a>=1024&&o<t.length-1;)a/=1024,o++;return`${a.toFixed(1)} ${t[o]}`};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(G,{title:"Respaldo y Restauraci√≥n - SENA"}),e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{href:route("configuraciones"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(M,{size:20})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:`mr-3 ${m.primaryText}`,size:24}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Respaldo y Restauraci√≥n"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gestiona los respaldos de tu base de datos"})]})]})]}),e.jsx(T,{href:route("configuraciones"),className:`px-4 py-2 ${m.primary} text-white rounded-md hover:opacity-90 transition-opacity`,children:"Volver"})]})})}),d.text&&e.jsx("div",{className:`max-w-7xl mx-auto mt-4 px-4 py-3 rounded-lg ${d.type==="success"?"bg-green-50 border border-green-200 text-green-800":d.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:d.text}),e.jsx("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(f,{className:"mr-2 text-green-600",size:20}),"Crear Respaldo"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Genera un respaldo completo de la base de datos. Se descargar√° autom√°ticamente cuando est√© listo."}),e.jsxs("button",{onClick:q,disabled:y,className:`w-full flex items-center justify-center px-4 py-3 ${m.primary} text-white rounded-md hover:opacity-90 transition-opacity disabled:opacity-50 font-medium`,children:[e.jsx(f,{className:"mr-2",size:16}),y?"‚è≥ Generando Respaldo...":"üì¶ Generar Respaldo Ahora"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(D,{className:"mr-2 text-orange-600",size:20}),"Restaurar Base de Datos"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(z,{className:"mr-2 text-yellow-600 mt-0.5",size:16}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"‚ö†Ô∏è Advertencia Importante"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"Esta acci√≥n sobrescribir√° TODOS los datos actuales del sistema. Aseg√∫rate de tener un respaldo de seguridad antes de proceder."})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Archivo SQL a Restaurar"}),e.jsx("input",{type:"file",accept:".sql",onChange:F,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),n&&e.jsxs("p",{className:"text-xs text-green-600",children:["‚úÖ Archivo seleccionado: ",n.name," (",C(n.size),")"]})]}),e.jsxs("button",{onClick:L,disabled:!n||N,className:"w-full flex items-center justify-center px-4 py-3 bg-orange-600 text-white rounded-md hover:bg-orange-700 transition-colors disabled:opacity-50 font-medium",children:[e.jsx(D,{className:"mr-2",size:16}),N?"‚è≥ Subiendo...":"üì§ Subir y Restaurar"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(P,{className:"mr-2 text-blue-600",size:20}),"Respaldos Disponibles"]}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:x.length>0?x.map((s,t)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("div",{className:"flex justify-between items-start mb-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900 break-all",children:s.filename}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["üìÖ ",B(s.date)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["üíæ ",s.size_formatted||C(s.size)]})]})}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>O(s.filename),className:"flex-1 text-xs px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors flex items-center justify-center gap-1",title:"Descargar",children:[e.jsx(f,{size:12}),"Descargar"]}),e.jsxs("button",{onClick:()=>U(s.filename),className:"flex-1 text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors flex items-center justify-center gap-1",title:"Eliminar",children:[e.jsx(K,{size:12}),"Eliminar"]})]})]},t)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"No hay respaldos disponibles"})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2 text-sm",children:"‚ÑπÔ∏è Consejos √ötiles"}),e.jsxs("ul",{className:"space-y-1 text-xs text-blue-800",children:[e.jsx("li",{children:"‚úì Respaldo autom√°tico incluye toda la BD"}),e.jsx("li",{children:"‚úì Descarga permite elegir ubicaci√≥n"}),e.jsx("li",{children:"‚úì Restaura desde cualquier .sql"}),e.jsx("li",{children:"‚úì Respaldos seguros y encriptados"}),e.jsx("li",{children:"‚úì Recomendado: respaldo semanal"})]})]})]})]})}),A&&p&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(z,{className:"mr-3 text-red-600",size:24}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Confirmar Restauraci√≥n"})]}),e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Archivo a restaurar:"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 break-all",children:p.backup_name})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 p-3 rounded mb-4",children:e.jsx("p",{className:"text-sm text-red-800 font-medium",children:"‚ö†Ô∏è ¬°ADVERTENCIA! Esta acci√≥n es irreversible"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ingresa tu contrase√±a para confirmar:"}),e.jsx("input",{type:"password",value:i,onChange:s=>h(s.target.value),onKeyPress:s=>s.key==="Enter"&&S(),placeholder:"Tu contrase√±a",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500",autoFocus:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{u(!1),h("")},className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors font-medium",children:"Cancelar"}),e.jsx("button",{onClick:S,disabled:k||!i,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors font-medium disabled:opacity-50",children:k?"‚è≥ Restaurando...":"‚úì Confirmar"})]})]})})]})}export{ne as default};
