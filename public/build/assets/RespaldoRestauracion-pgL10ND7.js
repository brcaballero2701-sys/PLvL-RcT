import{j as e}from"./app-BRN7_fgC.js";import{r as l,H as T,L as b}from"./vendor-x9zrslyQ.js";import{u as D}from"./useSystemColors-YCC1fkpO.js";import{A as F}from"./arrow-left-CnFJRCdA.js";import{c as v}from"./createLucideIcon-DJ0S87ah.js";import{D as d}from"./download-BHf5bgVU.js";import{D as L}from"./database-BFp9-wn7.js";import{U as j}from"./upload-B6YtIVIu.js";import{T as N}from"./triangle-alert-BIyt8psk.js";import{C as I}from"./calendar-lDWT8Q70.js";import{U}from"./user-XP-6RSYO.js";import{T as B}from"./trash-2-6pqDQCm4.js";const M=[["path",{d:"M13.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v11.5",key:"4pqfef"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 12v-1",key:"1ej8lb"}],["path",{d:"M8 18v-2",key:"qcmpov"}],["path",{d:"M8 7V6",key:"1nbb54"}],["circle",{cx:"8",cy:"20",r:"2",key:"ckkr5m"}]],O=v("file-archive",M);const q=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],G=v("hard-drive",q);function se({backups:m=[],diskSpace:w,databaseSize:k}){const{colors:o}=D(),[x,p]=l.useState(!1),[r,R]=l.useState(null),[h,u]=l.useState(!1),[z,n]=l.useState(!1),[i,f]=l.useState(null),E=async()=>{p(!0);try{const s=await(await fetch(route("admin.backup.generate"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();s.success?(alert("Respaldo generado exitosamente. La descarga comenzar√° autom√°ticamente."),window.location.href=s.download_url,setTimeout(()=>window.location.reload(),2e3)):alert("Error: "+s.message)}catch(a){alert("Error de conexi√≥n: "+a.message)}finally{p(!1)}},S=a=>{const s=a.target.files[0];if(s){if(s.type!=="application/zip"&&!s.name.endsWith(".zip")){alert("Por favor selecciona un archivo ZIP v√°lido");return}if(s.size>50*1024*1024){alert("El archivo es demasiado grande. Tama√±o m√°ximo: 50MB");return}R(s)}},C=async()=>{if(!r){alert("Por favor selecciona un archivo primero");return}u(!0);const a=new FormData;a.append("backup_file",r);try{const t=await(await fetch(route("admin.backup.upload"),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:a})).json();t.success?t.requires_confirmation?(f(t),n(!0)):(alert("Restauraci√≥n completada: "+t.message),window.location.reload()):alert("Error: "+t.message)}catch(s){alert("Error de conexi√≥n: "+s.message)}finally{u(!1)}},_=async()=>{try{const s=await(await fetch(route("admin.backup.confirm-restore"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({temp_path:i.temp_path,confirmation:1})})).json();s.success?(alert("Restauraci√≥n completada exitosamente. La aplicaci√≥n ser√° recargada."),window.location.reload()):alert("Error durante la restauraci√≥n: "+s.message)}catch(a){alert("Error: "+a.message)}finally{n(!1),f(null)}},A=async a=>{if(confirm("¬øEst√°s seguro de eliminar este respaldo? Esta acci√≥n no se puede deshacer."))try{const t=await(await fetch(route("admin.backup.delete",{backup:a}),{method:"DELETE",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}})).json();t.success?(alert("Respaldo eliminado exitosamente"),window.location.reload()):alert("Error: "+t.message)}catch(s){alert("Error: "+s.message)}},g=a=>new Date(a).toLocaleString("es-ES",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),y=a=>{const s=["B","KB","MB","GB"];let t=a,c=0;for(;t>=1024&&c<s.length-1;)t/=1024,c++;return`${t.toFixed(1)} ${s[c]}`};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(T,{title:"Respaldo y Restauraci√≥n - SENA"}),e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center py-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(b,{href:route("admin.configuraciones"),className:"mr-4 p-2 text-gray-600 hover:text-gray-900 transition-colors",children:e.jsx(F,{size:20})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:`mr-3 ${o.primaryText}`,size:24}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Respaldo y Restauraci√≥n"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configura el respaldo y la restauraci√≥n de los datos"})]})]})]}),e.jsx(b,{href:route("admin.configuraciones"),className:`px-4 py-2 ${o.primary} text-white rounded-md hover:opacity-90 transition-opacity`,children:"Volver"})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(d,{className:"mr-2 text-green-600",size:20}),"Respaldo"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-gray-600",children:"Genera un respaldo completo del sistema incluyendo base de datos, configuraciones y archivos importantes."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(L,{className:"mr-2 text-blue-600",size:16}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Base de Datos"})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Tama√±o: ",k.size_formatted]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(G,{className:"mr-2 text-purple-600",size:16}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Espacio Disponible"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:w.free_formatted})]})]}),e.jsxs("button",{onClick:E,disabled:x,className:`w-full flex items-center justify-center px-4 py-3 ${o.primary} text-white rounded-md hover:opacity-90 transition-opacity disabled:opacity-50`,children:[e.jsx(d,{className:"mr-2",size:16}),x?"Generando Respaldo...":"Generar Respaldo"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(j,{className:"mr-2 text-orange-600",size:20}),"Restauraci√≥n"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(N,{className:"mr-2 text-yellow-600 mt-0.5",size:16}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-yellow-800",children:"Advertencia Importante"}),e.jsx("p",{className:"text-xs text-yellow-700 mt-1",children:"La restauraci√≥n sobrescribir√° todos los datos actuales del sistema. Aseg√∫rate de tener un respaldo antes de proceder."})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Archivo de Respaldo (.zip)"}),e.jsx("input",{type:"file",accept:".zip",onChange:S,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),r&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Archivo seleccionado: ",r.name," (",y(r.size),")"]})]}),e.jsxs("button",{onClick:C,disabled:!r||h,className:"w-full flex items-center justify-center px-4 py-3 bg-orange-600 text-white rounded-md hover:bg-orange-700 transition-colors disabled:opacity-50",children:[e.jsx(j,{className:"mr-2",size:16}),h?"Subiendo Archivo...":"Subir Archivo"]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4 flex items-center",children:[e.jsx(I,{className:"mr-2 text-blue-600",size:20}),"√öltimos Respaldos"]}),e.jsx("div",{className:"space-y-3",children:m.length>0?m.map((a,s)=>e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:g(a.created_at)}),e.jsxs("div",{className:"flex items-center mt-1 text-xs text-gray-500",children:[e.jsx(U,{className:"mr-1",size:12}),a.created_by]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("a",{href:a.download_url,className:"text-blue-600 hover:text-blue-800 transition-colors",title:"Descargar",children:e.jsx(d,{size:14})}),e.jsx("button",{onClick:()=>A(a.name),className:"text-red-600 hover:text-red-800 transition-colors",title:"Eliminar",children:e.jsx(B,{size:14})})]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Tama√±o: ",y(a.size)]})]},s)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay respaldos disponibles"})})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-3",children:"üí° Informaci√≥n Importante"}),e.jsxs("ul",{className:"space-y-2 text-sm text-blue-800",children:[e.jsx("li",{children:"‚Ä¢ Los respaldos incluyen toda la base de datos"}),e.jsx("li",{children:"‚Ä¢ Se incluyen archivos de configuraci√≥n"}),e.jsx("li",{children:"‚Ä¢ Las im√°genes y archivos subidos se respaldan"}),e.jsx("li",{children:"‚Ä¢ Recomendado: respaldo diario o semanal"}),e.jsx("li",{children:"‚Ä¢ Almacena respaldos en ubicaci√≥n segura"})]})]})]})]})}),z&&i&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(N,{className:"mr-3 text-red-600",size:24}),e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Confirmar Restauraci√≥n"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Est√°s a punto de restaurar el sistema con el siguiente respaldo:"}),e.jsxs("div",{className:"bg-gray-50 p-3 rounded",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:i.backup_info.backup_name}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Creado por: ",i.backup_info.created_by]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Fecha: ",g(i.backup_info.created_at)]})]})]}),e.jsx("div",{className:"bg-red-50 border border-red-200 p-3 rounded mb-4",children:e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"¬°ADVERTENCIA!"})," Esta acci√≥n sobrescribir√° todos los datos actuales del sistema y no se puede deshacer."]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>n(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:_,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:"Confirmar Restauraci√≥n"})]})]})})]})}export{se as default};
